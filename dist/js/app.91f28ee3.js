(function(t){function e(e){for(var n,s,o=e[0],c=e[1],u=e[2],h=0,d=[];h<o.length;h++)s=o[h],Object.prototype.hasOwnProperty.call(i,s)&&i[s]&&d.push(i[s][0]),i[s]=0;for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(t[n]=c[n]);l&&l(e);while(d.length)d.shift()();return r.push.apply(r,u||[]),a()}function a(){for(var t,e=0;e<r.length;e++){for(var a=r[e],n=!0,o=1;o<a.length;o++){var c=a[o];0!==i[c]&&(n=!1)}n&&(r.splice(e--,1),t=s(s.s=a[0]))}return t}var n={},i={app:0},r=[];function s(e){if(n[e])return n[e].exports;var a=n[e]={i:e,l:!1,exports:{}};return t[e].call(a.exports,a,a.exports,s),a.l=!0,a.exports}s.m=t,s.c=n,s.d=function(t,e,a){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},s.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(s.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)s.d(a,n,function(e){return t[e]}.bind(null,n));return a},s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],c=o.push.bind(o);o.push=e,o=o.slice();for(var u=0;u<o.length;u++)e(o[u]);var l=c;r.push([0,"chunk-vendors"]),a()})({0:function(t,e,a){t.exports=a("cd49")},"00b2":function(t,e,a){"use strict";a("1877")},1877:function(t,e,a){},"1e09":function(t,e,a){},"23bc":function(t,e,a){"use strict";a("d221")},"3a66":function(t,e,a){},cd49:function(t,e,a){"use strict";a.r(e);a("e260"),a("e6cf"),a("cca6"),a("a79d");var n=a("2b0e"),i=a("5f5b"),r=(a("1e09"),function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"vh-100",attrs:{id:"app"}},[a("b-tabs",{staticClass:"full-height-tabs",attrs:{pills:"",card:"","nav-wrapper-class":"bg-dark"}},[a("b-tab",{staticClass:"p-0",attrs:{title:"Лаб 0",active:"","title-link-class":"text-white"}},[a("lab0")],1),a("b-tab",{staticClass:"p-0",attrs:{title:"Лаб 1","title-link-class":"text-white"}},[a("lab1")],1),a("b-tab",{staticClass:"p-0",attrs:{title:"Лаб 2","title-link-class":"text-white"}},[a("lab2")],1)],1)],1)}),s=[],o=a("d4ec"),c=a("262e"),u=a("2caf"),l=a("9ab4"),h=a("1b40"),d=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"container-fluid h-100"},[a("div",{staticClass:"row h-100"},[a("div",{staticClass:"col h-100 p-3"},[a("h6",[t._v("Current canvas size is "+t._s(t.currentCanvasWidth)+"X"+t._s(t.currentCanvasHeight)+"px")]),a("b-form-group",[a("b-input-group",{attrs:{prepend:"Height",append:"px",size:"sm"}},[a("b-form-input",{attrs:{type:"number",min:"0",step:"1"},model:{value:t.newCanvasHeight,callback:function(e){t.newCanvasHeight=e},expression:"newCanvasHeight"}})],1)],1),a("b-form-group",[a("b-input-group",{attrs:{prepend:"Width",append:"px",size:"sm"}},[a("b-form-input",{attrs:{type:"number",min:"0",step:"1"},model:{value:t.newCanvasWidth,callback:function(e){t.newCanvasWidth=e},expression:"newCanvasWidth"}})],1)],1),a("b-form-group",[a("b-button",{attrs:{size:"sm"},on:{click:t.resizeCanvas}},[t._v("Resize canvas")])],1),a("b-form-group",[a("b-form-file",{attrs:{accept:"image/jpeg, image/png",size:"sm"},model:{value:t.imgFile,callback:function(e){t.imgFile=e},expression:"imgFile"}})],1),a("b-form-group",[a("b-button",{attrs:{size:"sm"},on:{click:t.drawImage}},[t._v("Draw image")])],1),a("b-form-group",[a("b-button",{attrs:{size:"sm"},on:{click:t.saveImage}},[t._v("Save image")])],1),a("b-form-group",[a("b-button",{attrs:{size:"sm"},on:{click:t.invertColors}},[t._v("Invert colors")])],1),a("b-form-group",[a("b-button",{attrs:{size:"sm"},on:{click:t.drawRandomLine}},[t._v("Draw random line")])],1)],1),a("div",{staticClass:"col-9 h-100 bg-secondary canvas-container"},[a("canvas",{attrs:{id:t.canvasId}})])])])},v=[],g=a("3835"),f=a("bee2");a("b0c0"),a("d3b7"),a("3ca3"),a("ddb0"),a("2b3d"),a("25eb"),a("a9e3");function p(t,e){var a=document.createElement("a");a.download=e,a.href=URL.createObjectURL(t),a.click(),URL.revokeObjectURL(a.href)}function b(t,e){var a=t-.5+Math.random()*(e-t+1);return Math.round(a)}function m(t,e,a){for(var n=new Array(t),i=0;i<t;i++)n[i]=b(e[i],a[i]);return n}var C=function(t){Object(c["a"])(a,t);var e=Object(u["a"])(a);function a(){var t;return Object(o["a"])(this,a),t=e.apply(this,arguments),t.canvasId="lab0-canvas",t.imgFile=null,t.currentCanvasWidth=500,t.currentCanvasHeight=500,t.newCanvasWidth=500,t.newCanvasHeight=500,t.newSizeChanged=!1,t}return Object(f["a"])(a,[{key:"canvas",get:function(){return document.getElementById(this.canvasId)}},{key:"drawImage",value:function(){var t=this;if(this.imgFile){console.log("drawImage",{imageName:this.imgFile.name,size:this.imgFile.size});var e=new Image;e.src=URL.createObjectURL(this.imgFile),e.onload=function(){var a=t.canvas,n=a.getContext("2d");t.newCanvasWidth=t.currentCanvasWidth=a.width=e.width,t.newCanvasHeight=t.currentCanvasHeight=a.height=e.height,t.newSizeChanged=!1,n.fillStyle="white",n.fillRect(0,0,e.width,e.height),n.drawImage(e,0,0),URL.revokeObjectURL(e.src)}}}},{key:"saveImage",value:function(){console.log("saveImage");var t=this.canvas;t.toBlob((function(t){t&&p(t,"CG result")}))}},{key:"onNewCanvasWidthChanged",value:function(){this.newSizeChanged=!0}},{key:"onNewCanvasHeightChanged",value:function(){this.newSizeChanged=!0}},{key:"resizeCanvas",value:function(){console.log("resizeCanvas",{Height:this.newCanvasHeight,Width:this.newCanvasWidth});var t="number"!==typeof this.newCanvasHeight?Number.parseInt(this.newCanvasHeight):this.newCanvasHeight,e="number"!==typeof this.newCanvasWidth?Number.parseInt(this.newCanvasWidth):this.newCanvasWidth,a=document.getElementById(this.canvasId);this.currentCanvasHeight=a.height=t,this.currentCanvasWidth=a.width=e,this.newSizeChanged=!1;var n=a.getContext("2d");n.fillStyle="white",n.fillRect(0,0,e,t)}},{key:"invertColors",value:function(){for(var t=this.canvas,e=t.getContext("2d"),a=e.getImageData(0,0,t.width,t.height),n=0;n<a.data.length;n+=4)a.data[n]=255-a.data[n],a.data[n+1]=255-a.data[n+1],a.data[n+2]=255-a.data[n+2],a.data[n+3]=255;e.putImageData(a,0,0)}},{key:"drawRandomLine",value:function(){var t=this.canvas,e=t.getContext("2d"),a=b(1,10),n=m(2,[0,0],[this.currentCanvasWidth,this.currentCanvasHeight]),i=Object(g["a"])(n,2),r=i[0],s=i[1];e.beginPath(),e.moveTo(r,s);for(var o=0;o<a;o++){var c=m(2,[0,0],[this.currentCanvasWidth,this.currentCanvasHeight]),u=Object(g["a"])(c,2);r=u[0],s=u[1],e.lineTo(r,s)}e.stroke()}},{key:"mounted",value:function(){console.log("mounted",{Height:this.currentCanvasHeight,Width:this.currentCanvasWidth,this:this});var t=document.getElementById(this.canvasId),e=t.getContext("2d");t.height=this.currentCanvasHeight,t.width=this.currentCanvasWidth;var a=e.createRadialGradient(this.currentCanvasWidth/2,this.currentCanvasHeight/2,5,this.currentCanvasWidth/2,this.currentCanvasHeight/2,100);a.addColorStop(0,"red"),a.addColorStop(1,"white"),e.fillStyle=a,e.fillRect(0,0,this.currentCanvasWidth,this.currentCanvasHeight)}}]),a}(h["b"]);Object(l["a"])([Object(h["c"])("newCanvasHeight")],C.prototype,"onNewCanvasWidthChanged",null),Object(l["a"])([Object(h["c"])("newCanvasWidth")],C.prototype,"onNewCanvasHeightChanged",null),C=Object(l["a"])([h["a"]],C);var y=C,w=y,k=(a("23bc"),a("2877")),x=Object(k["a"])(w,d,v,!1,null,null,null),I=x.exports,P=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"container-fluid h-100"},[a("div",{staticClass:"h-100 row"},[a("div",{staticClass:"col h-100 p-3"},[a("b-form-group",[a("b-input-group",{attrs:{prepend:"(x, y):",size:"sm"}},[a("b-form-input",{attrs:{type:"number",min:"5",step:"1"},on:{keypress:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.resizeCanvas.apply(null,arguments)}},model:{value:t.newCanvasHeight,callback:function(e){t.newCanvasHeight=e},expression:"newCanvasHeight"}}),a("b-form-input",{attrs:{type:"number",min:"5",step:"1"},on:{keypress:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.resizeCanvas.apply(null,arguments)}},model:{value:t.newCanvasWidth,callback:function(e){t.newCanvasWidth=e},expression:"newCanvasWidth"}}),a("b-input-group-append",[a("b-input-group-text",[t._v("px")]),a("b-button",{attrs:{variant:t.newSizeChanged?"primary":"secondary"},on:{click:t.resizeCanvas}},[t._v("Обновить")])],1)],1)],1),a("b-form-group",[a("b-form-file",{attrs:{accept:"image/jpeg, image/png",size:"sm",placeholder:"Изображение для фона не выбрано","drop-placeholder":"Отпустите здесь","browse-text":"Выбрать"},model:{value:t.backgroundImageFile,callback:function(e){t.backgroundImageFile=e},expression:"backgroundImageFile"}})],1),a("b-form-group",[a("b-button",{attrs:{disabled:!t.points.length,variant:"danger",size:"sm"},on:{click:t.deletePoints}},[t._v(" Удалить точки ")])],1),a("b-form-group",[a("b-checkbox",{model:{value:t.drawDebugPoints,callback:function(e){t.drawDebugPoints=e},expression:"drawDebugPoints"}},[t._v("Отрисовывать отладочные точки")])],1),a("b-form-group",[a("b-button",{attrs:{size:"sm"},on:{click:t.saveImage}},[t._v("Сохранить изображение")])],1)],1),a("div",{staticClass:"h-100 bg-secondary canvas-container col-sm-4 col-md-5 col-lg-7 col-xl-9"},[a("canvas",{attrs:{id:t.canvasId},on:{click:t.addPoint}})])])])},O=[],j=a("b85c"),_=(a("c35a"),function(){function t(e,a){Object(o["a"])(this,t),this.x=e,this.y=a}return Object(f["a"])(t,[{key:"length",get:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"add",value:function(t){return this.x+=t.x,this.y+=t.y,this}},{key:"subtract",value:function(t){return this.x-=t.x,this.y-=t.y,this}},{key:"multiply",value:function(t){return this.x*=t,this.y*=t,this}},{key:"divide",value:function(t){return this.x/=t,this.y/=t,this}},{key:"copy",get:function(){return new t(this.x,this.y)}}]),t}()),H=function(t){Object(c["a"])(a,t);var e=Object(u["a"])(a);function a(){var t;return Object(o["a"])(this,a),t=e.apply(this,arguments),t.canvasId="lab1-canvas",t.backgroundImageFile=null,t.backgroundImage=null,t.imageIsLoaded=!1,t.points=[],t.drawDebugPoints=!1,t.currentCanvasWidth=500,t.currentCanvasHeight=500,t.newCanvasWidth=500,t.newCanvasHeight=500,t.newSizeChanged=!1,t}return Object(f["a"])(a,[{key:"canvas",get:function(){return document.getElementById(this.canvasId)}},{key:"onBackgroundImageFileChanged",value:function(t){var e=this;if(console.log("BackgroundImageChanged",{Name:null===t||void 0===t?void 0:t.name,Size:null===t||void 0===t?void 0:t.size}),this.imageIsLoaded&&URL.revokeObjectURL(this.backgroundImage.src),this.imageIsLoaded=!1,this.backgroundImage=null,t){var a=new Image;this.backgroundImage=a,a.src=URL.createObjectURL(t),a.onload=function(){console.log("image loaded",{name:t.name}),e.backgroundImage===a?(e.imageIsLoaded=!0,e.redraw()):URL.revokeObjectURL(a.src)}}else this.redraw()}},{key:"redraw",value:function(){this.drawBackground();var t,e=Object(j["a"])(this.points);try{for(e.s();!(t=e.n()).done;){var a=t.value;this.drawPoint(a)}}catch(n){e.e(n)}finally{e.f()}this.drawSpline()}},{key:"drawBackground",value:function(){console.log("Draw background");var t=this.canvas,e=t.getContext("2d");e.fillStyle="white",e.fillRect(0,0,this.currentCanvasWidth,this.currentCanvasHeight),this.imageIsLoaded&&e.drawImage(this.backgroundImage,0,0,this.backgroundImage.width,this.backgroundImage.height,0,0,t.width,t.height)}},{key:"drawPoint",value:function(t,e){var a=5;e=e||"red";var n=this.canvas.getContext("2d");n.strokeStyle=e,n.beginPath(),n.arc(t.x,t.y,a,0,2*Math.PI,!1),n.closePath(),n.stroke()}},{key:"drawSpline",value:function(){if(!(this.points.length<2)){var t=this.calculateAnchorPoints(),e=this.canvas.getContext("2d");e.strokeStyle="black",e.beginPath(),e.moveTo(this.points[0].x,this.points[0].y);for(var a=0;a<t.length;a++)e.bezierCurveTo(t[a][0].x,t[a][0].y,t[a][1].x,t[a][1].y,this.points[a+1].x,this.points[a+1].y);e.stroke()}}},{key:"onDrawDebugPointsChanged",value:function(){this.redraw()}},{key:"addPoint",value:function(t){var e=this.canvas,a=e.getBoundingClientRect(),n=t.clientX-a.left,i=t.clientY-a.top,r=new _(n,i);this.points.push(r),console.log("point was added",{x:n,y:i}),this.redraw()}},{key:"deletePoints",value:function(){this.points=[],this.redraw()}},{key:"calculateAnchorPoints",value:function(){if(this.points.length<2)return[];var t=new Array(this.points.length-1),e=this.points[1].copy.add(this.points[0]).divide(2),a=this.points[1].copy.subtract(this.points[0]).length;t[0]=[this.points[0].copy,this.points[1].copy],this.drawDebugPoints&&this.drawPoint(e,"black");for(var n=2;n<this.points.length;n++){var i=this.points[n].copy.add(this.points[n-1]).divide(2);this.drawDebugPoints&&this.drawPoint(i,"black");var r=this.points[n].copy.subtract(this.points[n-1]).length,s=i.copy.subtract(e).multiply(a/(r+a));this.drawDebugPoints&&this.drawPoint(e.copy.add(s),"yellow"),t[n-2][1].subtract(s),t[n-1]=[t[n-2][1].copy.add(i).subtract(e),this.points[n].copy],e=i,a=r}if(this.drawDebugPoints){var o,c=Object(j["a"])(t);try{for(c.s();!(o=c.n()).done;){var u=o.value;this.drawPoint(u[0],"blue"),this.drawPoint(u[1],"green")}}catch(l){c.e(l)}finally{c.f()}}return t}},{key:"saveImage",value:function(){console.log("saveImage");var t=this.canvas;t.toBlob((function(t){t&&p(t,"CG result")}))}},{key:"onNewCanvasWidthChanged",value:function(){this.newSizeChanged=!0}},{key:"onNewCanvasHeightChanged",value:function(){this.newSizeChanged=!0}},{key:"resizeCanvas",value:function(){console.log("resizeCanvas",{Height:this.newCanvasHeight,Width:this.newCanvasWidth});var t,e="number"!==typeof this.newCanvasHeight?Number.parseFloat(this.newCanvasHeight):this.newCanvasHeight,a="number"!==typeof this.newCanvasWidth?Number.parseFloat(this.newCanvasWidth):this.newCanvasWidth,n=a/this.currentCanvasWidth,i=e/this.currentCanvasHeight,r=Object(j["a"])(this.points);try{for(r.s();!(t=r.n()).done;){var s=t.value;s.x*=n,s.y*=i}}catch(c){r.e(c)}finally{r.f()}var o=this.canvas;this.currentCanvasHeight=o.height=e,this.currentCanvasWidth=o.width=a,this.newSizeChanged=!1,this.redraw()}},{key:"mounted",value:function(){console.log("mounted",{Height:this.currentCanvasHeight,Width:this.currentCanvasWidth,this:this});var t=this.canvas;t.height=this.currentCanvasHeight,t.width=this.currentCanvasWidth,this.redraw()}}]),a}(h["b"]);Object(l["a"])([Object(h["c"])("backgroundImageFile")],H.prototype,"onBackgroundImageFileChanged",null),Object(l["a"])([Object(h["c"])("drawDebugPoints")],H.prototype,"onDrawDebugPointsChanged",null),Object(l["a"])([Object(h["c"])("newCanvasHeight")],H.prototype,"onNewCanvasWidthChanged",null),Object(l["a"])([Object(h["c"])("newCanvasWidth")],H.prototype,"onNewCanvasHeightChanged",null),H=Object(l["a"])([h["a"]],H);var W=H,z=W,M=(a("00b2"),Object(k["a"])(z,P,O,!1,null,null,null)),S=M.exports,L=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"container-fluid h-100"},[a("div",{staticClass:"h-100 row"},[a("div",{staticClass:"col h-100 p-3"},[a("b-form-group",[a("b-form-file",{attrs:{accept:"image/jpeg, image/png",size:"sm",placeholder:"Изображение для фона не выбрано","drop-placeholder":"Отпустите здесь","browse-text":"Выбрать"},model:{value:t.sourceImageFile,callback:function(e){t.sourceImageFile=e},expression:"sourceImageFile"}})],1),a("b-form-group",[a("b-button",{attrs:{size:"sm"},on:{click:t.saveImage}},[t._v("Сохранить изображение")])],1),a("b-form-group",[a("b-button",{attrs:{disabled:!t.sourcePoints.length&&!t.resultPoints.length,variant:"danger",size:"sm"},on:{click:t.deletePoints}},[t._v(" Удалить точки ")])],1),a("b-form-group",[a("b-button",{attrs:{disabled:!t.sourcePoints.length||!t.resultPoints.length||!t.imageIsLoaded,variant:"primary",size:"sm"},on:{click:t.calculateResultImage}},[t._v(" Расчитать изображение ")])],1),a("b-form-group",{attrs:{label:"Ставить точки"}},[a("b-form-radio-group",{attrs:{options:[{text:"исходного",value:!0},{text:"итогового",value:!1}],"button-variant":"outline-primary",size:"sm",buttons:""},model:{value:t.sourceMode,callback:function(e){t.sourceMode=e},expression:"sourceMode"}})],1),a("b-form-group",[a("b-checkbox",{model:{value:t.useFiltration,callback:function(e){t.useFiltration=e},expression:"useFiltration"}},[t._v("Использовать фильтрацию")])],1),t.sourcePoints.length?a("div",{staticClass:"mb-3"},[a("h5",[t._v("Точки на исходном изображении")]),t._l(t.sourcePoints,(function(e){return a("div",{key:e.x+":"+e.y,staticClass:"input-group input-group-sm"},[t._m(0,!0),a("b-form-input",{attrs:{type:"number"},model:{value:e.x,callback:function(a){t.$set(e,"x",a)},expression:"point.x"}}),a("b-form-input",{attrs:{type:"number"},model:{value:e.y,callback:function(a){t.$set(e,"y",a)},expression:"point.y"}}),t._m(1,!0)],1)}))],2):t._e(),t.resultPoints.length?a("div",{staticClass:"mb-3"},[a("h5",[t._v("Точки на итоговом изображении")]),t._l(t.resultPoints,(function(e){return a("div",{key:e.x+":"+e.y,staticClass:"input-group input-group-sm"},[t._m(2,!0),a("b-form-input",{attrs:{type:"number"},model:{value:e.x,callback:function(a){t.$set(e,"x",a)},expression:"point.x"}}),a("b-form-input",{attrs:{type:"number"},model:{value:e.y,callback:function(a){t.$set(e,"y",a)},expression:"point.y"}}),t._m(3,!0)],1)}))],2):t._e()],1),a("b-tabs",{staticClass:"col-sm-4 col-md-5 col-lg-7 col-xl-9 full-height-tabs p-0",attrs:{pills:"","nav-wrapper-class":"bg-dark","active-nav-item-class":"text-dark bg-secondary border-0 mb-0","nav-item-class":"text-white border-0"}},[a("b-tab",{attrs:{title:"Исходое ихображение","title-link-class":"text-white"}},[a("div",{staticClass:"h-100 bg-secondary canvas-container"},[a("canvas",{attrs:{id:t.sourceCanvasId},on:{click:t.onSourceCanvasClicked}})])]),a("b-tab",{attrs:{title:"Итоговое","title-link-class":"text-white"}},[a("div",{staticClass:"h-100 bg-secondary canvas-container"},[a("canvas",{attrs:{id:t.resultCanvasId}})])])],1)],1)])},R=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"input-group-prepend"},[a("div",{staticClass:"input-group-text"},[t._v("X:")])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"input-group-append"},[a("div",{staticClass:"input-group-text"},[t._v(":Y")])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"input-group-prepend"},[a("div",{staticClass:"input-group-text"},[t._v("X:")])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"input-group-append"},[a("div",{staticClass:"input-group-text"},[t._v(":Y")])])}],F=(a("d81d"),a("90d7"),function(t){return t});function D(t,e){var a=e.length,n=e[0].length,i=t.length,r=t[0].length;if(n!=i)throw"Невозможно перемножить матрицы";for(var s=[],o=0;o<a;o++)s[o]=[];for(var c=0;c<r;c++)for(var u=0;u<a;u++){for(var l=0,h=0;h<i;h++)l+=e[u][h]*t[h][c];s[u][c]=l}return s}function U(t){for(var e=t.length,a=[],n=0;n<e;n++){a[n]=[];for(var i=0;i<e;i++){for(var r=[],s=(n+i)%2==0?1:-1,o=0;o<i;o++){r[o]=[];for(var c=0;c<n;c++)r[o][c]=t[o][c];for(var u=n+1;u<e;u++)r[o][u-1]=t[o][u]}for(var l=i+1;l<e;l++){r[l-1]=[];for(var h=0;h<n;h++)r[l-1][h]=t[l][h];for(var d=n+1;d<e;d++)r[l-1][d-1]=t[l][d]}a[n][i]=s*E(r)}}return a}function E(t){for(var e=t.length,a=[],n=1,i=0,r=0;r<e;++r){a[r]=[];for(var s=0;s<e;++s)a[r][s]=t[r][s]}for(var o=0;o<e-1;++o){for(var c=o,u=Math.abs(a[o][o]),l=o+1;l<e;++l){var h=Math.abs(a[l][o]);h>u&&(c=l,u=h)}if(c>o){var d=a[o];a[o]=a[c],a[c]=d,++i}else if(0==u)return u;for(var v=a[o][o],g=o+1;g<e;++g){var f=a[g][o];a[g][o]=0;for(var p=o+1;p<e;++p)a[g][p]=(a[g][p]*v-a[o][p]*f)/n}n=v}return i%2?-a[e-1][e-1]:a[e-1][e-1]}function B(t){var e=E(t);if(0==e)return null;var a=t.length;t=U(t);for(var n=0;n<a;n++)for(var i=0;i<a;i++)t[n][i]/=e;return t}var N=function(t){Object(c["a"])(a,t);var e=Object(u["a"])(a);function a(){var t;return Object(o["a"])(this,a),t=e.apply(this,arguments),t.sourceCanvasId="lab2-source-canvas",t.resultCanvasId="lab2-result-canvas",t.useFiltration=!0,t.sourceImageFile=null,t.sourceImage=null,t.imageIsLoaded=!1,t.sourcePoints=[],t.resultPoints=[],t.sourceMode=!0,t}return Object(f["a"])(a,[{key:"sourceCanvas",get:function(){return document.getElementById(this.sourceCanvasId)}},{key:"resultCanvas",get:function(){return document.getElementById(this.resultCanvasId)}},{key:"onSourceCanvasClicked",value:function(t){var e=this.sourceCanvas,a=e.getBoundingClientRect(),n=t.clientX-a.left,i=t.clientY-a.top;this.sourceMode?this.addSourcePoint(new _(n,i)):this.addResultPoint(new _(n,i))}},{key:"resizeCanvas",value:function(t,e){var a,n=this.sourceCanvas,i=t/n.width,r=e/n.height,s=Object(j["a"])(this.sourcePoints);try{for(s.s();!(a=s.n()).done;){var o=a.value;o.x*=i,o.y*=r}}catch(h){s.e(h)}finally{s.f()}var c,u=Object(j["a"])(this.resultPoints);try{for(u.s();!(c=u.n()).done;){var l=c.value;l.x*=i,l.y*=r}}catch(h){u.e(h)}finally{u.f()}n.height=e,n.width=t,this.redraw()}},{key:"onSourceImageFileChanged",value:function(t){var e=this;if(this.imageIsLoaded&&URL.revokeObjectURL(this.sourceImage.src),this.imageIsLoaded=!1,this.sourceImage=null,t){var a=new Image;this.sourceImage=a,a.src=URL.createObjectURL(t),a.onload=function(){e.sourceImage===a?(e.resizeCanvas(a.width,a.height),e.imageIsLoaded=!0,e.redraw()):URL.revokeObjectURL(a.src)}}else this.redraw()}},{key:"calculateResultImage",value:function(){if(this.sourcePoints.length<3||this.resultPoints.length<3)throw"Недостаточно точек";this.drawSourceImage();var t=[this.sourcePoints.map((function(t){return t.x})),this.sourcePoints.map((function(t){return t.y})),[1,1,1]],e=[this.resultPoints.map((function(t){return t.x})),this.resultPoints.map((function(t){return t.y})),[1,1,1]],a=B(e),n=B(t),i=D(a,t),r=D(n,e);console.log({G:t,G1:e,inverseG:n,inverseG1:a,A:r,inverseA:i});var s=this.sourceCanvas,o=s.width,c=s.height,u=[[0,c-1,1],[o-1,c-1,1],[0,0,1],[o,0,1]],l=u.map((function(t){return D(t.map((function(t){return[t]})),r).map((function(t){return t[0]}))})).map((function(t){return t.map(Math.round)})),h={maxX:l.reduce((function(t,e){return Math.max(t,e[0])}),-1/0),maxY:l.reduce((function(t,e){return Math.max(t,e[1])}),-1/0),minX:l.reduce((function(t,e){return Math.min(t,e[0])}),1/0),minY:l.reduce((function(t,e){return Math.min(t,e[1])}),1/0)},d=this.resultCanvas,v=[h.minX,h.minY],f=h.maxX-h.minX,p=h.maxY-h.minY;d.width=f,d.height=p;for(var b=s.getContext("2d"),m=b.getImageData(0,0,o,c),C=d.getContext("2d"),y=C.getImageData(0,0,f,p),w=function(t,e){return e*(4*o)+4*t},k=function(t,e){return e*(4*f)+4*t},x=0;x<f;x++)for(var I=0;I<p;I++){var P=x+v[0],O=I+v[1],j=[[P,P+1,P],[O,O,O+1],[1,1,1,1]],H=D(j,i),W=H.map((function(t){return t[0]})),z=Object(g["a"])(W,2),M=z[0],S=z[1],L=new _(M,S).subtract(new _(H[0][1],H[1][1])).length,R=new _(M,S).subtract(new _(H[0][2],H[1][2])).length,F=(L+R)/2,U=k(x,I);if(this.useFiltration)if(F<1){for(var E=[[Math.floor(M),Math.floor(S)],[Math.ceil(M),Math.floor(S)],[Math.floor(M),Math.ceil(S)],[Math.ceil(M),Math.ceil(S)]],N=0,$=E;N<$.length;N++){var X=$[N];X[0]<0||X[0]>=o||X[1]<0||X[1]>=c?(X[0]=0,X[1]=0,X[2]=0):X[2]=(1-Math.abs(X[0]-M))*(1-Math.abs(X[1]-S))}for(var Y=0;Y<4;Y++)y.data[U+Y]=m.data[w(E[0][0],E[0][1])+Y]*E[0][2]+m.data[w(E[1][0],E[1][1])+Y]*E[1][2]+m.data[w(E[2][0],E[2][1])+Y]*E[2][2]+m.data[w(E[3][0],E[3][1])+Y]*E[3][2]}else{if(M<0||M>=o||S<0||S>=c)continue;for(var G=Math.pow(2,Math.floor(Math.log2(F))),T=2*G,A=Math.floor(M/G)*G,J=Math.floor(S/G)*G,q=Math.floor(M/T)*T,K=Math.floor(S/T)*T,Q=0;Q<4;Q++){for(var V=0,Z=0;Z<G;Z++)for(var tt=0;tt<G;tt++){var et=w(A+Z,J+tt);V+=m.data[Q+et]}V/=G*G;for(var at=0,nt=0;nt<T;nt++)for(var it=0;it<T;it++)at+=m.data[Q+w(q+nt,K+it)];at/=T*T,y.data[U+Q]=(V*(T-F)+at*(F-G))/G}}else{if(M=Math.round(M),S=Math.round(S),M<0||M>=o||S<0||S>=c)continue;var rt=w(M,S);y.data[U]=m.data[rt],y.data[U+1]=m.data[rt+1],y.data[U+2]=m.data[rt+2],y.data[U+3]=m.data[rt+3]}}this.redraw(),C.putImageData(y,0,0)}},{key:"redraw",value:function(){this.drawSourceImage(),this.drawPoints()}},{key:"drawSourceImage",value:function(){var t=this.sourceCanvas,e=t.getContext("2d");e.fillStyle="white",e.fillRect(0,0,t.width,t.height),this.imageIsLoaded&&e.drawImage(this.sourceImage,0,0,this.sourceImage.width,this.sourceImage.height,0,0,t.width,t.height)}},{key:"drawPoint",value:function(t,e,a){var n=(null===a||void 0===a?void 0:a.radius)||5,i=(null===a||void 0===a?void 0:a.color)||"red",r=e.getContext("2d");r.strokeStyle=i,r.beginPath(),r.arc(t.x,t.y,n,0,2*Math.PI,!1),r.closePath(),r.stroke()}},{key:"drawPoints",value:function(){var t,e=Object(j["a"])(this.sourcePoints);try{for(e.s();!(t=e.n()).done;){var a=t.value;this.drawPoint(a,this.sourceCanvas)}}catch(s){e.e(s)}finally{e.f()}var n,i=Object(j["a"])(this.resultPoints);try{for(i.s();!(n=i.n()).done;){var r=n.value;this.drawPoint(r,this.sourceCanvas,{color:"blue"})}}catch(s){i.e(s)}finally{i.f()}}},{key:"addSourcePoint",value:function(t){this.sourcePoints.length>=3&&this.sourcePoints.shift(),this.sourcePoints.push(t)}},{key:"addResultPoint",value:function(t){this.resultPoints.length>=3&&this.resultPoints.shift(),this.resultPoints.push(t)}},{key:"deletePoints",value:function(){this.sourcePoints=[],this.resultPoints=[],this.redraw()}},{key:"onSourcePointsChanged",value:function(){console.log("На изменении массива точек"),this.redraw()}},{key:"saveImage",value:function(){var t=this.resultCanvas;t.toBlob((function(t){t&&p(t,"CG result")}))}},{key:"mounted",value:function(){var t=this.sourceCanvas;t.height=512,t.width=512,this.redraw()}}]),a}(h["b"]);Object(l["a"])([Object(h["c"])(F("sourceImageFile"))],N.prototype,"onSourceImageFileChanged",null),Object(l["a"])([Object(h["c"])(F("resultPoints"),{deep:!0}),Object(h["c"])(F("sourcePoints"),{deep:!0})],N.prototype,"onSourcePointsChanged",null),N=Object(l["a"])([h["a"]],N);var $=N,X=$,Y=(a("e9fa"),Object(k["a"])(X,L,R,!1,null,null,null)),G=Y.exports,T=function(t){Object(c["a"])(a,t);var e=Object(u["a"])(a);function a(){return Object(o["a"])(this,a),e.apply(this,arguments)}return a}(h["b"]);T=Object(l["a"])([Object(h["a"])({components:{Lab2:G,Lab1:S,Lab0:I}})],T);var A=T,J=A,q=Object(k["a"])(J,r,s,!1,null,null,null),K=q.exports;n["default"].config.productionTip=!1,n["default"].use(i["a"]),new n["default"]({render:function(t){return t(K)}}).$mount("#app")},d221:function(t,e,a){},e9fa:function(t,e,a){"use strict";a("3a66")}});
//# sourceMappingURL=app.91f28ee3.js.map